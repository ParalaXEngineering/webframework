{% extends 'base.j2' %}

{% block title %}
Internal server error
{% endblock %}

{% block main_page %}
    <div class="card bg-danger text-white shadow">
        <div class="card-body">
            {%if error %}
            <div class="text-white-50 small"><strong>Error:</strong> {{error}}</div>
            {% endif %}
            {%if traceback %}
            {% if enable_bug_tracker %}
            <div class="text-white-50 small mt-2">The server encountered an error. Please use the button below to report this issue with context information already filled in.</div>
            {% else %}
            <div class="text-white-50 small mt-2">The server encountered an error. Please contact the administrator.</div>
            {% endif %}
            
            <!-- Additional Error Context -->
            {% if method or url %}
            <div class="text-white-50 small mt-3">
                <strong>Request Details:</strong>
                <ul class="mb-0">
                    {% if method %}<li>Method: {{ method }}</li>{% endif %}
                    {% if url %}<li>URL: {{ url }}</li>{% endif %}
                    {% if endpoint %}<li>Endpoint: {{ endpoint }}</li>{% endif %}
                    {% if remote_addr %}<li>Client IP: {{ remote_addr }}</li>{% endif %}
                    {% if get_params %}
                    <li>GET Parameters: 
                        <ul>
                        {% for key, value in get_params.items() %}
                            <li>{{ key }}: {{ value }}</li>
                        {% endfor %}
                        </ul>
                    </li>
                    {% endif %}
                    {% if post_params %}
                    <li>POST Parameters: 
                        <ul>
                        {% for key, value in post_params.items() %}
                            <li>{{ key }}: {{ value }}</li>
                        {% endfor %}
                        </ul>
                    </li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}
            
            <div class="text-white-50 small mt-3"><pre>Traceback: {{traceback}} </pre></div>
            
            <!-- Report Bug Button (only shown if bug tracker is enabled) -->
            {% if enable_bug_tracker %}
            <div class="mt-3">
                <a href="{{ url_for('bug.report_error') }}" 
                   class="btn btn-warning btn-lg">
                    <i class="fas fa-bug"></i> Report This Error
                </a>
            </div>
            {% endif %}
            {% endif %}
        </div>
    </div>

    <div class="d-flex align-items-center justify-content-center">
        <img src="{{ url_for('static', filename= 'images/site/500.jpg')}}" width="500vw">
    </div>
    
{% endblock %}