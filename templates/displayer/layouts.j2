{% import 'displayer/items.j2' as disp_item %}

{% macro display_layout(layout = [])%}
    {% if layout["type"] == "VERT" %}
        {{ display_vertical_layout(layout["columns"], layout["containers"], layout["align"], layout["spacing"], layout["height"], layout["background"], layout["user_id"], layout["style"]) }}
    {% elif layout["type"] == "HORIZ" %}
        {{ display_horizontal_layout(layout["columns"], layout["containers"], layout["align"], layout["spacing"]) }}
    {% elif layout["type"] == "TABLE" %}
        {{ display_table_layout(layout["header"], layout["lines"], layout["responsive"], layout["responsive_type"], layout["user_id"]) }}
    {% elif layout["type"] == "TABS" %}
        {{ display_tabs_layout(layout["header"], layout["lines"]) }}
    {% elif layout["type"] == "SPACER" %}
        <div><p style="margin-bottom:1cm;"></p></div>
          
    {% endif %}
{% endmacro %}

{% macro display_horizontal_layout(columns=[], containers = [], align = [], spacing = 0) %}
    TOCODE
{% endmacro %}

{% macro display_vertical_layout(columns=[], containers = [], align = [], spacing = 0, height = 0, background = none, user_id = none, style = none) %}
    <div class="row my-1 {{spacing}} align-items-center {% if background %}bg-{{background}}{% endif %} {% if style %}{{style}}{% endif %}" {% if user_id %} id="{{user_id}}"{% endif %} >
    {# For each columns #}
    {% for col in columns %}
        <div class="col-{{col}} text-{{align[loop.index0]}}">
        
        {# Display all the items in the containers one another #}
        {% for element in containers[loop.index0] %}
            {% if height %}
                <div style="height: {{ height * 50 }}px">
            {% endif %}
                {% if element["object"] == "item" %}
                    {{ disp_item.display_item(element) }}
                {% elif element["object"] == "layout" %}
                {#<div class="row">#}
                    {{ display_layout(element)}}
                {#</div>#}
                {% else %}
                    NOT SUPPORTED
                {% endif %}
            
            {% if height %}
                </div>
            {% endif %}
        {% endfor %}

        </div>
    {% endfor %}
    </div>

{% endmacro %}

{% macro display_table_layout(header=[], lines = [], responsive = None, responsive_type = None, user_id = none) %}    
    <div class="row m-1" {% if user_id %} id="{{user_id}}"{% endif %}>
    <div class="table-responsive">
        <table class="table table-striped mb-0" 
                   {% if responsive %}
                        id="{{ responsive_type }}_{{ responsive }}"                       
                   {% endif %}>
            <thead>
                <tr>
                    {% for head in header %}
                        <th>{{ head }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
            {% if lines %}
                {% for line in lines %}
                    <tr>
                    {% for item in line %}
                        <td>
                            {% for element in item %}
                                {% if element["object"] == "item" %}
                                    {{ disp_item.display_item(element) }}
                                {% elif element["object"] == "layout" %}
                                    {{ display_layout(element)}}
                                {% else %}
                                    NOT SUPPORTED
                                {% endif %}
                            {% endfor %}
                        </td>
                    {% endfor %}
                    </tr>
                {% endfor %}
            {% endif %}
            </tbody>

            </table>
        </div>
    </div>
{% endmacro %}

{% macro display_tabs_layout(header=[], lines=[]) %}
    <ul class="nav nav-tabs" id="myTab" role="tablist">
    {% for head in header %}
    <li class="nav-item" role="presentation">
        <a class="nav-link {% if loop.first %}active{% endif %}" 
        id="tab{{ loop.index }}-tab" 
        data-bs-toggle="tab" 
        href="#tab{{ loop.index }}" 
        role="tab" 
        aria-controls="tab{{ loop.index }}" 
        aria-selected="{{ 'true' if loop.first else 'false' }}">
        {{ head }}
        </a>
    </li>
    {% endfor %}
    </ul>

    <div class="tab-content" id="myTabContent">
    {% for items in lines[0] %}
        <div class="tab-pane fade {% if loop.first %}show active{% endif %}" 
            id="tab{{ loop.index }}" 
            role="tabpanel" 
            aria-labelledby="tab{{ loop.index }}-tab">
            {% for element in items %}
                {% if element["object"] == "item" %}
                    {{ disp_item.display_item(element) }}
                {% elif element["object"] == "layout" %}
                    {{ display_layout(element) }}
                {% else %}
                    NOT SUPPORTED IN TABS for {{ element["object"] }}
                {% endif %}
            {% endfor %}
        </div>
    {% endfor %}
    </div>
{% endmacro %}
