import{GridStackEngine}from"./gridstack-engine";import{Utils,obsolete}from"./utils";import{gridDefaults}from"./types";import{DDGridStack}from"./dd-gridstack";import{isTouch}from"./dd-touch";import{DDManager}from"./dd-manager";const dd=new DDGridStack;export*from"./types";export*from"./utils";export*from"./gridstack-engine";export*from"./dd-gridstack";export*from"./dd-manager";export*from"./dd-element";export*from"./dd-draggable";export*from"./dd-droppable";export*from"./dd-resizable";export*from"./dd-resizable-handle";export*from"./dd-base-impl";class GridStack{static init(t={},e=".grid-stack"){if("undefined"==typeof document)return null;const i=GridStack.getGridElement(e);return i?(i.gridstack||(i.gridstack=new GridStack(i,Utils.cloneDeep(t))),i.gridstack):("string"==typeof e?console.error('GridStack.initAll() no grid was found with selector "'+e+'" - element missing or wrong selector ?\nNote: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.'):console.error("GridStack.init() no grid element was passed."),null)}static initAll(e={},t=".grid-stack"){const i=[];return"undefined"==typeof document||(GridStack.getGridElements(t).forEach(t=>{t.gridstack||(t.gridstack=new GridStack(t,Utils.cloneDeep(e))),i.push(t.gridstack)}),0===i.length&&console.error('GridStack.initAll() no grid was found with selector "'+t+'" - element missing or wrong selector ?\nNote: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.')),i}static addGrid(t,e={}){if(!t)return null;let i=t;if(i.gridstack){const s=i.gridstack;return e&&(s.opts={...s.opts,...e}),void 0!==e.children&&s.load(e.children),s}t.classList.contains("grid-stack")&&!GridStack.addRemoveCB||(i=GridStack.addRemoveCB?GridStack.addRemoveCB(t,e,!0,!0):Utils.createDiv(["grid-stack",e.class],t));const s=GridStack.init(e,i);return s}static registerEngine(t){GridStack.engineClass=t}get placeholder(){if(!this._placeholder){this._placeholder=Utils.createDiv([this.opts.placeholderClass,gridDefaults.itemClass,this.opts.itemClass]);const t=Utils.createDiv(["placeholder-content"],this._placeholder);this.opts.placeholderText&&(t.textContent=this.opts.placeholderText)}return this._placeholder}constructor(t,e={}){this.el=t,this.opts=e,this.animationDelay=310,this._gsEventHandler={},this._extraDragRow=0,this.dragTransform={xScale:1,yScale:1,xOffset:0,yOffset:0},(t.gridstack=this).opts=e=e||{},t.classList.contains("grid-stack")||this.el.classList.add("grid-stack"),e.row&&(e.minRow=e.maxRow=e.row,delete e.row);var i=Utils.toNumber(t.getAttribute("gs-row"));"auto"===e.column&&delete e.column,void 0!==e.alwaysShowResizeHandle&&(e._alwaysShowResizeHandle=e.alwaysShowResizeHandle);const s=e.columnOpts;if(s){const a=s.breakpoints;s.columnWidth||a?.length?(s.columnMax=s.columnMax||12,1<a?.length&&a.sort((t,e)=>(e.w||0)-(t.w||0))):delete e.columnOpts}const r={...Utils.cloneDeep(gridDefaults),column:Utils.toNumber(t.getAttribute("gs-column"))||gridDefaults.column,minRow:i||Utils.toNumber(t.getAttribute("gs-min-row"))||gridDefaults.minRow,maxRow:i||Utils.toNumber(t.getAttribute("gs-max-row"))||gridDefaults.maxRow,staticGrid:Utils.toBool(t.getAttribute("gs-static"))||gridDefaults.staticGrid,sizeToContent:Utils.toBool(t.getAttribute("gs-size-to-content"))||void 0,draggable:{handle:(e.handleClass?"."+e.handleClass:e.handle||"")||gridDefaults.draggable.handle},removableOptions:{accept:e.itemClass||gridDefaults.removableOptions.accept,decline:gridDefaults.removableOptions.decline}},o=(t.getAttribute("gs-animate")&&(r.animate=Utils.toBool(t.getAttribute("gs-animate"))),e=Utils.defaults(e,r),this._initMargin(),this.checkDynamicColumn(),this._updateColumnVar(e),"auto"===e.rtl&&(e.rtl="rtl"===t.style.direction),e.rtl&&this.el.classList.add("grid-stack-rtl"),this.el.closest("."+gridDefaults.itemClass)?.gridstackNode),n=(o&&((o.subGrid=this).parentGridNode=o,this.el.classList.add("grid-stack-nested"),o.el.classList.add("grid-stack-sub-grid")),this._isAutoCellHeight="auto"===e.cellHeight,this._isAutoCellHeight||"initial"===e.cellHeight?this.cellHeight(void 0):("number"==typeof e.cellHeight&&e.cellHeightUnit&&e.cellHeightUnit!==gridDefaults.cellHeightUnit&&(e.cellHeight=e.cellHeight+e.cellHeightUnit,delete e.cellHeightUnit),i=e.cellHeight,delete e.cellHeight,this.cellHeight(i)),"mobile"===e.alwaysShowResizeHandle&&(e.alwaysShowResizeHandle=isTouch),this._setStaticClass(),e.engineClass||GridStack.engineClass||GridStackEngine);this.engine=new n({column:this.getColumn(),float:e.float,maxRow:e.maxRow,onChange:t=>{t.forEach(t=>{const e=t.el;e&&(t._removeDOM?(e&&e.remove(),delete t._removeDOM):this._writePosAttr(e,t))}),this._updateContainerHeight()}}),e.auto&&(this.batchUpdate(),this.engine._loading=!0,this.getGridItems().forEach(t=>this._prepareElement(t)),delete this.engine._loading,this.batchUpdate(!1)),e.children&&(t=e.children,delete e.children,t.length&&this.load(t)),this.setAnimation(),e.subGridDynamic&&!DDManager.pauseDrag&&(DDManager.pauseDrag=!0),void 0!==e.draggable?.pause&&(DDManager.pauseDrag=e.draggable.pause),this._setupRemoveDrop(),this._setupAcceptWidget(),this._updateResizeEvent()}_updateColumnVar(t=this.opts){this.el.classList.add("gs-"+t.column),"number"==typeof t.column&&this.el.style.setProperty("--gs-column-width",100/t.column+"%")}addWidget(i){if(i)if("string"==typeof i)console.error("V11: GridStack.addWidget() does not support string anymore. see #2736");else{if(i.ELEMENT_NODE)return console.error("V11: GridStack.addWidget() does not support HTMLElement anymore. use makeWidget()"),this.makeWidget(i);let t,e=i;if(e.grid=this,t=e.el||(GridStack.addRemoveCB?GridStack.addRemoveCB(this.el,i,!0,!1):this.createWidgetDivs(e))){if((e=t.gridstackNode)&&t.parentElement===this.el&&this.engine.nodes.find(t=>t._id===e._id))return t;var s=this._readAttr(t);return Utils.defaults(i,s),this.engine.prepareNode(i),this.el.appendChild(t),this.makeWidget(t,i),t}}}createWidgetDivs(e){const t=Utils.createDiv(["grid-stack-item",this.opts.itemClass]),i=Utils.createDiv(["grid-stack-item-content"],t);return Utils.lazyLoad(e)?e.visibleObservable||(e.visibleObservable=new IntersectionObserver(([t])=>{t.isIntersecting&&(e.visibleObservable?.disconnect(),delete e.visibleObservable,GridStack.renderCB(i,e),e.grid?.prepareDragDrop(e.el))}),window.setTimeout(()=>e.visibleObservable?.observe(t))):GridStack.renderCB(i,e),t}makeSubGrid(t,e,i,s=!0){let r=t.gridstackNode;if((r=r||this.makeWidget(t).gridstackNode).subGrid?.el)return r.subGrid;let o,n=this;for(;n&&!o;)o=n.opts?.subGridOpts,n=n.parentGridNode?.grid;e=Utils.cloneDeep({...this.opts,id:void 0,children:void 0,column:"auto",columnOpts:void 0,layout:"list",subGridOpts:void 0,...o||{},...e||r.subGridOpts||{}});let a,d=("auto"===(r.subGridOpts=e).column&&(a=!0,e.column=Math.max(r.w||1,i?.w||1),delete e.columnOpts),r.el.querySelector(".grid-stack-item-content")),l,h;if(s&&(this._removeDD(r.el),h={...r,x:0,y:0},Utils.removeInternalForSave(h),delete h.subGridOpts,r.content&&(h.content=r.content,delete r.content),GridStack.addRemoveCB?l=GridStack.addRemoveCB(this.el,h,!0,!1):((l=Utils.createDiv(["grid-stack-item"])).appendChild(d),d=Utils.createDiv(["grid-stack-item-content"],r.el)),this.prepareDragDrop(r.el)),i){var t=a?e.column:r.w,g=r.h+i.h;const m=r.el.style;m.transition="none",this.update(r.el,{w:t,h:g}),setTimeout(()=>m.transition=null)}const c=r.subGrid=GridStack.addGrid(d,e);return i?._moving&&(c._isTemp=!0),a&&(c._autoColumn=!0),s&&c.makeWidget(l,h),i&&(i._moving?window.setTimeout(()=>Utils.simulateMouseEvent(i._event,"mouseenter",c.el),0):c.makeWidget(r.el,r)),this.resizeToContentCheck(!1,r),c}removeAsSubGrid(t){const e=this.parentGridNode?.grid;e&&(e.batchUpdate(),e.removeWidget(this.parentGridNode.el,!0,!0),this.engine.nodes.forEach(t=>{t.x+=this.parentGridNode.x,t.y+=this.parentGridNode.y,e.makeWidget(t.el,t)}),e.batchUpdate(!1),this.parentGridNode&&delete this.parentGridNode.subGrid,delete this.parentGridNode,t&&window.setTimeout(()=>Utils.simulateMouseEvent(t._event,"mouseenter",e.el),0))}save(i=!0,s=!1,r=GridStack.saveCB,t){const e=this.engine.save(i,r,t);if(e.forEach(t=>{var e;i&&t.el&&!t.subGrid&&!r?(e=t.el.querySelector(".grid-stack-item-content"),t.content=e?.innerHTML,t.content||delete t.content):(i||r||delete t.content,t.subGrid?.el&&(e=t.w||t.subGrid.getColumn(),e=t.subGrid.save(i,s,r,e),t.subGridOpts=s?e:{children:e},delete t.subGrid)),delete t.el}),s){const o=Utils.cloneDeep(this.opts);o.marginBottom===o.marginTop&&o.marginRight===o.marginLeft&&o.marginTop===o.marginRight&&(o.margin=o.marginTop,delete o.marginTop,delete o.marginRight,delete o.marginBottom,delete o.marginLeft),o.rtl===("rtl"===this.el.style.direction)&&(o.rtl="auto"),this._isAutoCellHeight&&(o.cellHeight="auto"),this._autoColumn&&(o.column="auto");t=o._alwaysShowResizeHandle;return delete o._alwaysShowResizeHandle,void 0!==t?o.alwaysShowResizeHandle=t:delete o.alwaysShowResizeHandle,Utils.removeInternalAndSame(o,gridDefaults),o.children=e,o}return e}load(e,s=GridStack.addRemoveCB||!0){e=Utils.cloneDeep(e);var t=this.getColumn();e.forEach(t=>{t.w=t.w||t.minW||1,t.h=t.h||t.minH||1}),e=Utils.sort(e),this.engine.skipCacheUpdate=this._ignoreLayoutsNodeChange=!0;let i=0;e.forEach(t=>{i=Math.max(i,(t.x||0)+t.w)}),i>this.engine.defaultColumn&&(this.engine.defaultColumn=i),i>t&&(0===this.engine.nodes.length&&this.responseLayout?(this.engine.nodes=e,this.engine.columnChanged(i,t,this.responseLayout),e=this.engine.nodes,this.engine.nodes=[],delete this.responseLayout):this.engine.cacheLayout(e,i,!0));t=GridStack.addRemoveCB;"function"==typeof s&&(GridStack.addRemoveCB=s);const r=[];this.batchUpdate();var o=!this.engine.nodes.length,n=o&&this.opts.animate;if(n&&this.setAnimation(!1),!o&&s){const d=[...this.engine.nodes];d.forEach(t=>{t.id&&!Utils.find(e,t.id)&&(GridStack.addRemoveCB&&GridStack.addRemoveCB(this.el,t,!1,!1),r.push(t),this.removeWidget(t.el,!0,!1))})}this.engine._loading=!0;const a=[];return this.engine.nodes=this.engine.nodes.filter(t=>!Utils.find(e,t.id)||(a.push(t),!1)),e.forEach(t=>{const e=Utils.find(a,t.id);if(e){if(Utils.shouldSizeToContent(e)&&(t.h=e.h),this.engine.nodeBoundFix(t),!t.autoPosition&&void 0!==t.x&&void 0!==t.y||(t.w=t.w||e.w,t.h=t.h||e.h,this.engine.findEmptyPosition(t)),this.engine.nodes.push(e),Utils.samePos(e,t)&&1<this.engine.nodes.length&&(this.moveNode(e,{...t,forceCollide:!0}),Utils.copyPos(t,e)),this.update(e.el,t),t.subGridOpts?.children){const i=e.el.querySelector(".grid-stack");i&&i.gridstack&&i.gridstack.load(t.subGridOpts.children)}}else s&&this.addWidget(t)}),delete this.engine._loading,this.engine.removedNodes=r,this.batchUpdate(!1),delete this._ignoreLayoutsNodeChange,delete this.engine.skipCacheUpdate,t?GridStack.addRemoveCB=t:delete GridStack.addRemoveCB,n&&this.setAnimation(!0,!0),this}batchUpdate(t=!0){return this.engine.batchUpdate(t),t||(this._updateContainerHeight(),this._triggerRemoveEvent(),this._triggerAddEvent(),this._triggerChangeEvent()),this}getCellHeight(t=!1){if(this.opts.cellHeight&&"auto"!==this.opts.cellHeight&&(!t||!this.opts.cellHeightUnit||"px"===this.opts.cellHeightUnit))return this.opts.cellHeight;if("rem"===this.opts.cellHeightUnit)return this.opts.cellHeight*parseFloat(getComputedStyle(document.documentElement).fontSize);if("em"===this.opts.cellHeightUnit)return this.opts.cellHeight*parseFloat(getComputedStyle(this.el).fontSize);if("cm"===this.opts.cellHeightUnit)return this.opts.cellHeight*(96/2.54);if("mm"===this.opts.cellHeightUnit)return this.opts.cellHeight*(96/2.54)/10;const e=this.el.querySelector("."+this.opts.itemClass);if(e)return t=Utils.toNumber(e.getAttribute("gs-h"))||1,Math.round(e.offsetHeight/t);t=parseInt(this.el.getAttribute("gs-current-row"));return t?Math.round(this.el.getBoundingClientRect().height/t):this.opts.cellHeight}cellHeight(t){void 0!==t&&this._isAutoCellHeight!==("auto"===t)&&(this._isAutoCellHeight="auto"===t,this._updateResizeEvent()),void 0===(t="initial"!==t&&"auto"!==t?t:void 0)&&(e=-this.opts.marginRight-this.opts.marginLeft+this.opts.marginTop+this.opts.marginBottom,t=this.cellWidth()+e);var e=Utils.parseHeight(t);return this.opts.cellHeightUnit===e.unit&&this.opts.cellHeight===e.h||(this.opts.cellHeightUnit=e.unit,this.opts.cellHeight=e.h,this.el.style.setProperty("--gs-cell-height",""+this.opts.cellHeight+this.opts.cellHeightUnit),this._updateContainerHeight(),this.resizeToContentCheck()),this}cellWidth(){return this._widthOrContainer()/this.getColumn()}_widthOrContainer(t=!1){return(!t||!this.opts.columnOpts?.breakpointForWindow)&&(this.el.clientWidth||this.el.parentElement.clientWidth)||window.innerWidth}checkDynamicColumn(){const e=this.opts.columnOpts;if(!e||!e.columnWidth&&!e.breakpoints?.length)return!1;var i=this.getColumn();let s=i;var t,r=this._widthOrContainer(!0);if(e.columnWidth)s=Math.min(Math.round(r/e.columnWidth)||1,e.columnMax);else{s=e.columnMax;let t=0;for(;t<e.breakpoints.length&&r<=e.breakpoints[t].w;)s=e.breakpoints[t++].c||i}return s!==i&&(t=e.breakpoints?.find(t=>t.c===s),this.column(s,t?.layout||e.layout),!0)}compact(t="compact",e=!0){return this.engine.compact(t,e),this._triggerChangeEvent(),this}column(t,e="moveScale"){if(!t||t<1||this.opts.column===t)return this;var i=this.getColumn();return this.opts.column=t,this.engine?(this.engine.column=t,this.el.classList.remove("gs-"+i),this._updateColumnVar(),this.engine.columnChanged(i,t,e),this._isAutoCellHeight&&this.cellHeight(),this.resizeToContentCheck(!0),this._ignoreLayoutsNodeChange=!0,this._triggerChangeEvent(),delete this._ignoreLayoutsNodeChange):this.responseLayout=e,this}getColumn(){return this.opts.column}getGridItems(){return Array.from(this.el.children).filter(t=>t.matches("."+this.opts.itemClass)&&!t.matches("."+this.opts.placeholderClass))}isIgnoreChangeCB(){return this._ignoreLayoutsNodeChange}destroy(t=!0){if(this.el)return this.offAll(),this._updateResizeEvent(!0),this.setStatic(!0,!1),this.setAnimation(!1),t?this.el.parentNode.removeChild(this.el):(this.removeAll(t),this.el.removeAttribute("gs-current-row")),this.parentGridNode&&delete this.parentGridNode.subGrid,delete this.parentGridNode,delete this.opts,delete this._placeholder?.gridstackNode,delete this._placeholder,delete this.engine,delete this.el.gridstack,delete this.el,this}float(t){return this.opts.float!==t&&(this.opts.float=this.engine.float=t,this._triggerChangeEvent()),this}getFloat(){return this.engine.float}getCellFromPixel(t,e=!1){var i=this.el.getBoundingClientRect();let s;s=e?{top:i.top+document.documentElement.scrollTop,left:i.left}:{top:this.el.offsetTop,left:this.el.offsetLeft};var e=t.left-s.left,t=t.top-s.top,r=i.width/this.getColumn(),i=i.height/parseInt(this.el.getAttribute("gs-current-row"));return{x:Math.floor(e/r),y:Math.floor(t/i)}}getRow(){return Math.max(this.engine.getRow(),this.opts.minRow||0)}isAreaEmpty(t,e,i,s){return this.engine.isAreaEmpty(t,e,i,s)}makeWidget(t,e){t=GridStack.getElement(t);if(!t||t.gridstackNode)return t;t.parentElement||this.el.appendChild(t),this._prepareElement(t,!0,e);e=t.gridstackNode;this._updateContainerHeight(),e.subGridOpts&&this.makeSubGrid(t,e.subGridOpts,void 0,!1);let i;return 1!==this.opts.column||this._ignoreLayoutsNodeChange||(i=this._ignoreLayoutsNodeChange=!0),this._triggerAddEvent(),this._triggerChangeEvent(),i&&delete this._ignoreLayoutsNodeChange,t}on(t,e){if(-1===t.indexOf(" "))return"change"===t||"added"===t||"removed"===t||"enable"===t||"disable"===t?(this._gsEventHandler[t]="enable"===t||"disable"===t?t=>e(t):t=>{t.detail&&e(t,t.detail)},this.el.addEventListener(t,this._gsEventHandler[t])):"drag"===t||"dragstart"===t||"dragstop"===t||"resizestart"===t||"resize"===t||"resizestop"===t||"dropped"===t||"resizecontent"===t?this._gsEventHandler[t]=e:console.error("GridStack.on("+t+") event not supported"),this;{const i=t.split(" ");return i.forEach(t=>this.on(t,e)),this}}off(t){if(-1===t.indexOf(" "))return"change"!==t&&"added"!==t&&"removed"!==t&&"enable"!==t&&"disable"!==t||this._gsEventHandler[t]&&this.el.removeEventListener(t,this._gsEventHandler[t]),delete this._gsEventHandler[t],this;{const e=t.split(" ");return e.forEach(t=>this.off(t)),this}}offAll(){return Object.keys(this._gsEventHandler).forEach(t=>this.off(t)),this}removeWidget(t,i=!0,s=!0){return t?(GridStack.getElements(t).forEach(e=>{if(!e.parentElement||e.parentElement===this.el){let t=e.gridstackNode;(t=t||this.engine.nodes.find(t=>e===t.el))&&(i&&GridStack.addRemoveCB&&GridStack.addRemoveCB(this.el,t,!1,!1),delete e.gridstackNode,this._removeDD(e),this.engine.removeNode(t,i,s),i&&e.parentElement&&e.remove())}}),s&&(this._triggerRemoveEvent(),this._triggerChangeEvent())):console.error("Error: GridStack.removeWidget(undefined) called"),this}removeAll(e=!0,t=!0){return this.engine.nodes.forEach(t=>{e&&GridStack.addRemoveCB&&GridStack.addRemoveCB(this.el,t,!1,!1),delete t.el.gridstackNode,this.opts.staticGrid||this._removeDD(t.el)}),this.engine.removeAll(e,t),t&&this._triggerRemoveEvent(),this}setAnimation(t=this.opts.animate,e){return e?setTimeout(()=>{this.opts&&this.setAnimation(t)}):t?this.el.classList.add("grid-stack-animate"):this.el.classList.remove("grid-stack-animate"),this.opts.animate=t,this}hasAnimationCSS(){return this.el.classList.contains("grid-stack-animate")}setStatic(e,i=!0,s=!0){return!!this.opts.staticGrid===e||(e?this.opts.staticGrid=!0:delete this.opts.staticGrid,this._setupRemoveDrop(),this._setupAcceptWidget(),this.engine.nodes.forEach(t=>{this.prepareDragDrop(t.el),t.subGrid&&s&&t.subGrid.setStatic(e,i,s)}),i&&this._setStaticClass()),this}updateOptions(t){const e=this.opts;return t===e||(void 0!==t.acceptWidgets&&(e.acceptWidgets=t.acceptWidgets,this._setupAcceptWidget()),void 0!==t.animate&&this.setAnimation(t.animate),t.cellHeight&&this.cellHeight(t.cellHeight),void 0!==t.class&&t.class!==e.class&&(e.class&&this.el.classList.remove(e.class),t.class&&this.el.classList.add(t.class)),t.columnOpts?(this.opts.columnOpts=t.columnOpts,this.checkDynamicColumn()):null===t.columnOpts&&this.opts.columnOpts?(delete this.opts.columnOpts,this._updateResizeEvent()):"number"==typeof t.column&&this.column(t.column),void 0!==t.margin&&this.margin(t.margin),void 0!==t.staticGrid&&this.setStatic(t.staticGrid),void 0===t.disableDrag||t.staticGrid||this.enableMove(!t.disableDrag),void 0===t.disableResize||t.staticGrid||this.enableResize(!t.disableResize),void 0!==t.float&&this.float(t.float),void 0!==t.row?(e.minRow=e.maxRow=e.row=t.row,this._updateContainerHeight()):(void 0!==t.minRow&&(e.minRow=t.minRow,this._updateContainerHeight()),void 0!==t.maxRow&&(e.maxRow=t.maxRow)),t.children?.length&&this.load(t.children)),this}update(t,h){return GridStack.getElements(t).forEach(s=>{const r=s?.gridstackNode;if(r){const n={...Utils.copyPos({},r),...Utils.cloneDeep(h)},a=(this.engine.nodeBoundFix(n),delete n.autoPosition,["x","y","w","h"]);let e;if(a.some(t=>void 0!==n[t]&&n[t]!==r[t])&&(e={},a.forEach(t=>{e[t]=(void 0!==n[t]?n:r)[t],delete n[t]})),!e&&(n.minW||n.minH||n.maxW||n.maxH)&&(e={}),void 0!==n.content){const d=s.querySelector(".grid-stack-item-content");d&&d.textContent!==n.content&&(r.content=n.content,GridStack.renderCB(d,n),r.subGrid?.el&&(d.appendChild(r.subGrid.el),r.subGrid._updateContainerHeight())),delete n.content}let t=!1,i=!1;for(const l in n)"_"!==l[0]&&r[l]!==n[l]&&(r[l]=n[l],t=!0,i=i||!this.opts.staticGrid&&("noResize"===l||"noMove"===l||"locked"===l));var o;Utils.sanitizeMinMax(r),e&&(o=void 0!==e.w&&e.w!==r.w,this.moveNode(r,e),o&&r.subGrid?r.subGrid.onResize(this.hasAnimationCSS()?r.w:void 0):this.resizeToContentCheck(o,r),delete r._orig),(e||t)&&this._writeAttr(s,r),i&&this.prepareDragDrop(r.el),GridStack.updateCB&&GridStack.updateCB(r)}}),this}moveNode(t,e){var i=t._updating;i||this.engine.cleanNodes().beginUpdate(t),this.engine.moveNode(t,e),this._updateContainerHeight(),i||(this._triggerChangeEvent(),this.engine.endUpdate())}resizeToContent(i){if(i&&(i.classList.remove("size-to-content-max"),i.clientHeight)){const d=i.gridstackNode;if(d){const l=d.grid;if(l&&i.parentElement===l.el){var s=l.getCellHeight(!0);if(s){var r=d.h?d.h*s:i.clientHeight;let t;if(t=(t=d.resizeToContentParent?i.querySelector(d.resizeToContentParent):t)||i.querySelector(GridStack.resizeToContentParent)){var o=i.clientHeight-t.clientHeight,o=d.h?d.h*s-o:t.clientHeight;let e;if(d.subGrid){e=d.subGrid.getRow()*d.subGrid.getCellHeight(!0);var n=d.subGrid.el.getBoundingClientRect(),a=i.getBoundingClientRect();e+=n.top-a.top}else{if(d.subGridOpts?.children?.length)return;{const h=t.firstElementChild;if(!h)return void console.error(`Error: GridStack.resizeToContent() widget id:${d.id} '${GridStack.resizeToContentParent}'.firstElementChild is null, make sure to have a div like container. Skipping sizing.`);e=h.getBoundingClientRect().height||o}}if(o!==e){r+=e-o;let t=Math.ceil(r/s);n=Number.isInteger(d.sizeToContent)?d.sizeToContent:0;n&&t>n&&(t=n,i.classList.add("size-to-content-max")),d.minH&&t<d.minH?t=d.minH:d.maxH&&t>d.maxH&&(t=d.maxH),t!==d.h&&(l._ignoreLayoutsNodeChange=!0,l.moveNode(d,{h:t}),delete l._ignoreLayoutsNodeChange)}}}}}}}resizeToContentCBCheck(t){GridStack.resizeToContentCB?GridStack.resizeToContentCB(t):this.resizeToContent(t)}rotate(t,o){return GridStack.getElements(t).forEach(t=>{const e=t.gridstackNode;if(Utils.canBeRotated(e)){const r={w:e.h,h:e.w,minH:e.minW,minW:e.minH,maxH:e.maxW,maxW:e.maxH};o&&(i=0<o.left?Math.floor(o.left/this.cellWidth()):0,s=0<o.top?Math.floor(o.top/this.opts.cellHeight):0,r.x=e.x+i-(e.h-(s+1)),r.y=e.y+s-i),Object.keys(r).forEach(t=>{void 0===r[t]&&delete r[t]});var i,s=e._orig;this.update(t,r),e._orig=s}}),this}margin(t){if(!("string"==typeof t&&1<t.split(" ").length)){var e=Utils.parseHeight(t);if(this.opts.marginUnit===e.unit&&this.opts.margin===e.h)return}return this.opts.margin=t,this.opts.marginTop=this.opts.marginBottom=this.opts.marginLeft=this.opts.marginRight=void 0,this._initMargin(),this}getMargin(){return this.opts.margin}willItFit(t){var e,i;return 1<arguments.length?(console.warn("gridstack.ts: `willItFit(x,y,w,h,autoPosition)` is deprecated. Use `willItFit({x, y,...})`. It will be removed soon"),i=0,i={x:(e=arguments)[i++],y:e[i++],w:e[i++],h:e[i++],autoPosition:e[4]},this.willItFit(i)):this.engine.willItFit(t)}_triggerChangeEvent(){if(this.engine.batchMode)return this;var t=this.engine.getDirtyNodes(!0);return t&&t.length&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(t),this._triggerEvent("change",t)),this.engine.saveInitial(),this}_triggerAddEvent(){return this.engine.batchMode||this.engine.addedNodes?.length&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(this.engine.addedNodes),this.engine.addedNodes.forEach(t=>{delete t._dirty}),t=[...this.engine.addedNodes],this.engine.addedNodes=[],this._triggerEvent("added",t)),this;var t}_triggerRemoveEvent(){return this.engine.batchMode||this.engine.removedNodes?.length&&(t=[...this.engine.removedNodes],this.engine.removedNodes=[],this._triggerEvent("removed",t)),this;var t}_triggerEvent(t,e){e=e?new CustomEvent(t,{bubbles:!1,detail:e}):new Event(t);let i=this;for(;i.parentGridNode;)i=i.parentGridNode.grid;return i.el.dispatchEvent(e),this}_updateContainerHeight(){if(!this.engine||this.engine.batchMode)return this;const t=this.parentGridNode;let e=this.getRow()+this._extraDragRow;var i,s=this.opts.cellHeight,r=this.opts.cellHeightUnit;return s&&(t||this.opts.minRow||0<(i=Utils.parseHeight(getComputedStyle(this.el).minHeight)).h&&i.unit===r&&(i=Math.floor(i.h/s),e<i&&(e=i)),this.el.setAttribute("gs-current-row",String(e)),this.el.style.removeProperty("min-height"),this.el.style.removeProperty("height"),e&&(this.el.style[t?"minHeight":"height"]=e*s+r),t&&Utils.shouldSizeToContent(t)&&t.grid.resizeToContentCBCheck(t.el)),this}_prepareElement(t,e=!1,i){i=i||this._readAttr(t),(t.gridstackNode=i).el=t,i.grid=this,i=this.engine.addNode(i,e),this._writeAttr(t,i),t.classList.add(gridDefaults.itemClass,this.opts.itemClass);e=Utils.shouldSizeToContent(i);return e?t.classList.add("size-to-content"):t.classList.remove("size-to-content"),e&&this.resizeToContentCheck(!1,i),Utils.lazyLoad(i)||this.prepareDragDrop(i.el),this}_writePosAttr(t,e){return(e._moving||e._resizing)&&this._placeholder!==t||(t.style.top=e.y?1===e.y?"var(--gs-cell-height)":`calc(${e.y} * var(--gs-cell-height))`:null,t.style.left=e.x?1===e.x?"var(--gs-column-width)":`calc(${e.x} * var(--gs-column-width))`:null,t.style.width=1<e.w?`calc(${e.w} * var(--gs-column-width))`:null,t.style.height=1<e.h?`calc(${e.h} * var(--gs-cell-height))`:null),0<e.x?t.setAttribute("gs-x",String(e.x)):t.removeAttribute("gs-x"),0<e.y?t.setAttribute("gs-y",String(e.y)):t.removeAttribute("gs-y"),1<e.w?t.setAttribute("gs-w",String(e.w)):t.removeAttribute("gs-w"),1<e.h?t.setAttribute("gs-h",String(e.h)):t.removeAttribute("gs-h"),this}_writeAttr(t,e){if(!e)return this;this._writePosAttr(t,e);var i={noResize:"gs-no-resize",noMove:"gs-no-move",locked:"gs-locked",id:"gs-id",sizeToContent:"gs-size-to-content"};for(const s in i)e[s]?t.setAttribute(i[s],String(e[s])):t.removeAttribute(i[s]);return this}_readAttr(t,e=!0){const i={};i.x=Utils.toNumber(t.getAttribute("gs-x")),i.y=Utils.toNumber(t.getAttribute("gs-y")),i.w=Utils.toNumber(t.getAttribute("gs-w")),i.h=Utils.toNumber(t.getAttribute("gs-h")),i.autoPosition=Utils.toBool(t.getAttribute("gs-auto-position")),i.noResize=Utils.toBool(t.getAttribute("gs-no-resize")),i.noMove=Utils.toBool(t.getAttribute("gs-no-move")),i.locked=Utils.toBool(t.getAttribute("gs-locked"));var s=t.getAttribute("gs-size-to-content");s&&(i.sizeToContent="true"===s||"false"===s?Utils.toBool(s):parseInt(s,10)),i.id=t.getAttribute("gs-id"),i.maxW=Utils.toNumber(t.getAttribute("gs-max-w")),i.minW=Utils.toNumber(t.getAttribute("gs-min-w")),i.maxH=Utils.toNumber(t.getAttribute("gs-max-h")),i.minH=Utils.toNumber(t.getAttribute("gs-min-h")),e&&(1===i.w&&t.removeAttribute("gs-w"),1===i.h&&t.removeAttribute("gs-h"),i.maxW&&t.removeAttribute("gs-max-w"),i.minW&&t.removeAttribute("gs-min-w"),i.maxH&&t.removeAttribute("gs-max-h"),i.minH&&t.removeAttribute("gs-min-h"));for(const r in i){if(!i.hasOwnProperty(r))return;i[r]||0===i[r]||"sizeToContent"===r||delete i[r]}return i}_setStaticClass(){var t=["grid-stack-static"];return this.opts.staticGrid?(this.el.classList.add(...t),this.el.setAttribute("gs-static","true")):(this.el.classList.remove(...t),this.el.removeAttribute("gs-static")),this}onResize(e=this.el?.clientWidth){if(e&&this.prevWidth!==e){this.prevWidth=e,this.batchUpdate();let t=!1;return this._autoColumn&&this.parentGridNode?this.opts.column!==this.parentGridNode.w&&(this.column(this.parentGridNode.w,this.opts.layout||"list"),t=!0):t=this.checkDynamicColumn(),this._isAutoCellHeight&&this.cellHeight(),this.engine.nodes.forEach(t=>{t.subGrid&&t.subGrid.onResize()}),this._skipInitialResize||this.resizeToContentCheck(t),delete this._skipInitialResize,this.batchUpdate(!1),this}}resizeToContentCheck(t=!1,e=void 0){if(this.engine){if(t&&this.hasAnimationCSS())return setTimeout(()=>this.resizeToContentCheck(!1,e),this.animationDelay);if(e)Utils.shouldSizeToContent(e)&&this.resizeToContentCBCheck(e.el);else if(this.engine.nodes.some(t=>Utils.shouldSizeToContent(t))){const i=[...this.engine.nodes];this.batchUpdate(),i.forEach(t=>{Utils.shouldSizeToContent(t)&&this.resizeToContentCBCheck(t.el)}),this._ignoreLayoutsNodeChange=!0,this.batchUpdate(!1),this._ignoreLayoutsNodeChange=!1}this._gsEventHandler.resizecontent&&this._gsEventHandler.resizecontent(null,e?[e]:this.engine.nodes)}}_updateResizeEvent(t=!1){var e=!this.parentGridNode&&(this._isAutoCellHeight||this.opts.sizeToContent||this.opts.columnOpts||this.engine.nodes.find(t=>t.sizeToContent));return t||!e||this.resizeObserver?!t&&e||!this.resizeObserver||(this.resizeObserver.disconnect(),delete this.resizeObserver,delete this._sizeThrottle):(this._sizeThrottle=Utils.throttle(()=>this.onResize(),this.opts.cellHeightThrottle),this.resizeObserver=new ResizeObserver(()=>this._sizeThrottle()),this.resizeObserver.observe(this.el),this._skipInitialResize=!0),this}static getElement(t=".grid-stack-item"){return Utils.getElement(t)}static getElements(t=".grid-stack-item"){return Utils.getElements(t)}static getGridElement(t){return GridStack.getElement(t)}static getGridElements(t){return Utils.getElements(t)}_initMargin(){let e,i=0,t=[];2===(t="string"==typeof this.opts.margin?this.opts.margin.split(" "):t).length?(this.opts.marginTop=this.opts.marginBottom=t[0],this.opts.marginLeft=this.opts.marginRight=t[1]):4===t.length?(this.opts.marginTop=t[0],this.opts.marginRight=t[1],this.opts.marginBottom=t[2],this.opts.marginLeft=t[3]):(e=Utils.parseHeight(this.opts.margin),this.opts.marginUnit=e.unit,i=this.opts.margin=e.h);["marginTop","marginRight","marginBottom","marginLeft"].forEach(t=>{void 0===this.opts[t]?this.opts[t]=i:(e=Utils.parseHeight(this.opts[t]),this.opts[t]=e.h,delete this.opts.margin)}),this.opts.marginUnit=e.unit,this.opts.marginTop===this.opts.marginBottom&&this.opts.marginLeft===this.opts.marginRight&&this.opts.marginTop===this.opts.marginRight&&(this.opts.margin=this.opts.marginTop);const s=this.el.style;return s.setProperty("--gs-item-margin-top",""+this.opts.marginTop+this.opts.marginUnit),s.setProperty("--gs-item-margin-bottom",""+this.opts.marginBottom+this.opts.marginUnit),s.setProperty("--gs-item-margin-right",""+this.opts.marginRight+this.opts.marginUnit),s.setProperty("--gs-item-margin-left",""+this.opts.marginLeft+this.opts.marginUnit),this}static getDD(){return dd}static setupDragIn(t,i,s,e=document){void 0!==i?.pause&&(DDManager.pauseDrag=i.pause),i={appendTo:"body",helper:"clone",...i||{}};const r="string"==typeof t?Utils.getElements(t,e):t;r.forEach((t,e)=>{dd.isDraggable(t)||dd.dragIn(t,i),s?.[e]&&(t.gridstackNode=s[e])})}movable(t,i){return this.opts.staticGrid||GridStack.getElements(t).forEach(t=>{const e=t.gridstackNode;e&&(i?delete e.noMove:e.noMove=!0,this.prepareDragDrop(e.el))}),this}resizable(t,i){return this.opts.staticGrid||GridStack.getElements(t).forEach(t=>{const e=t.gridstackNode;e&&(i?delete e.noResize:e.noResize=!0,this.prepareDragDrop(e.el))}),this}disable(t=!0){if(!this.opts.staticGrid)return this.enableMove(!1,t),this.enableResize(!1,t),this._triggerEvent("disable"),this}enable(t=!0){if(!this.opts.staticGrid)return this.enableMove(!0,t),this.enableResize(!0,t),this._triggerEvent("enable"),this}enableMove(e,i=!0){return this.opts.staticGrid||(e?delete this.opts.disableDrag:this.opts.disableDrag=!0,this.engine.nodes.forEach(t=>{this.prepareDragDrop(t.el),t.subGrid&&i&&t.subGrid.enableMove(e,i)})),this}enableResize(e,i=!0){return this.opts.staticGrid||(e?delete this.opts.disableResize:this.opts.disableResize=!0,this.engine.nodes.forEach(t=>{this.prepareDragDrop(t.el),t.subGrid&&i&&t.subGrid.enableResize(e,i)})),this}cancelDrag(){const t=this._placeholder?.gridstackNode;t&&(t._isExternal?(t._isAboutToRemove=!0,this.engine.removeNode(t)):t._isAboutToRemove&&GridStack._itemRemoving(t.el,!1),this.engine.restoreInitial())}_removeDD(t){return dd.draggable(t,"destroy").resizable(t,"destroy"),t.gridstackNode&&delete t.gridstackNode._initDD,delete t.ddElement,this}_setupAcceptWidget(){if(this.opts.staticGrid||!this.opts.acceptWidgets&&!this.opts.removable)return dd.droppable(this.el,"destroy"),this;let a,d;const l=(t,e,i)=>{const s=(i=i||e).gridstackNode;if(s){s.grid?.el||(i.style.transform=`scale(${1/this.dragTransform.xScale},${1/this.dragTransform.yScale})`,r=i.getBoundingClientRect(),i.style.left=r.x+(this.dragTransform.xScale-1)*(t.clientX-r.x)/this.dragTransform.xScale+"px",i.style.top=r.y+(this.dragTransform.yScale-1)*(t.clientY-r.y)/this.dragTransform.yScale+"px",i.style.transformOrigin="0px 0px");var{top:r,left:o}=i.getBoundingClientRect(),n=this.el.getBoundingClientRect(),n=(o-=n.left,{position:{top:(r-=n.top)*this.dragTransform.xScale,left:o*this.dragTransform.yScale}});if(s._temporaryRemoved){if(s.x=Math.max(0,Math.round(o/d)),s.y=Math.max(0,Math.round(r/a)),delete s.autoPosition,this.engine.nodeBoundFix(s),!this.engine.willItFit(s)){if(s.autoPosition=!0,!this.engine.willItFit(s))return void dd.off(e,"drag");s._willFitPos&&(Utils.copyPos(s,s._willFitPos),delete s._willFitPos)}this._onStartMoving(i,t,n,s,d,a)}else this._dragOrResize(i,t,n,s,d,a)}};return dd.droppable(this.el,{accept:t=>{var e,i=t.gridstackNode||this._readAttr(t,!1);if(i?.grid===this)return!0;if(!this.opts.acceptWidgets)return!1;let s=!0;return(s="function"==typeof this.opts.acceptWidgets?this.opts.acceptWidgets(t):(e=!0===this.opts.acceptWidgets?".grid-stack-item":this.opts.acceptWidgets,t.matches(e)))&&i&&this.opts.maxRow&&(t={w:i.w,h:i.h,minW:i.minW,minH:i.minH},s=this.engine.willItFit(t)),s}}).on(this.el,"dropover",(t,e,i)=>{let s=i?.gridstackNode||e.gridstackNode;if(s?.grid===this&&!s._temporaryRemoved)return!1;if(s?._sidebarOrig&&(s.w=s._sidebarOrig.w,s.h=s._sidebarOrig.h),s?.grid&&s.grid!==this&&!s._temporaryRemoved){const n=s.grid;n._leave(e,i)}if(i=i||e,d=this.cellWidth(),a=this.getCellHeight(!0),!s){var r=i.getAttribute("data-gs-widget")||i.getAttribute("gridstacknode");if(r){try{s=JSON.parse(r)}catch(t){console.error("Gridstack dropover: Bad JSON format: ",r)}i.removeAttribute("data-gs-widget"),i.removeAttribute("gridstacknode")}(s=s||this._readAttr(i))._sidebarOrig={w:s.w,h:s.h}}s.grid||((s=s.el?s:{...s})._isExternal=!0,i.gridstackNode=s);var r=s.w||Math.round(i.offsetWidth/d)||1,o=s.h||Math.round(i.offsetHeight/a)||1;return s.grid&&s.grid!==this?(e._gridstackNodeOrig||(e._gridstackNodeOrig=s),e.gridstackNode=s={...s,w:r,h:o,grid:this},delete s.x,delete s.y,this.engine.cleanupNode(s).nodeBoundFix(s),s._initDD=s._isExternal=s._temporaryRemoved=!0):(s.w=r,s.h=o,s._temporaryRemoved=!0),GridStack._itemRemoving(s.el,!1),dd.on(e,"drag",l),l(t,e,i),!1}).on(this.el,"dropout",(t,e,i)=>{var s=i?.gridstackNode||e.gridstackNode;return s&&(s.grid&&s.grid!==this||(this._leave(e,i),this._isTemp&&this.removeAsSubGrid(s))),!1}).on(this.el,"drop",(t,e,i)=>{const s=i?.gridstackNode||e.gridstackNode;if(s?.grid===this&&!s._isExternal)return!1;var r=!!this.placeholder.parentElement,o=e!==i,n=(this.placeholder.remove(),delete this.placeholder.gridstackNode,r&&this.opts.animate&&(this.setAnimation(!1),this.setAnimation(!0,!0)),e._gridstackNodeOrig);if(delete e._gridstackNodeOrig,r&&n?.grid&&n.grid!==this){const d=n.grid;d.engine.removeNodeFromLayoutCache(n),d.engine.removedNodes.push(n),d._triggerRemoveEvent()._triggerChangeEvent(),d.parentGridNode&&!d.engine.nodes.length&&d.opts.subGridDynamic&&d.removeAsSubGrid()}if(!s)return!1;if(r&&(this.engine.cleanupNode(s),s.grid=this),delete s.grid?._isTemp,dd.off(e,"drag"),i!==e?(i.remove(),e=i):e.remove(),this._removeDD(e),!r)return!1;const a=s.subGrid?.el?.gridstack;return Utils.copyPos(s,this._readAttr(this.placeholder)),Utils.removePositioningStyles(e),o&&(s.content||s.subGridOpts||GridStack.addRemoveCB)?(delete s.el,e=this.addWidget(s)):(this._prepareElement(e,!0,s),this.el.appendChild(e),this.resizeToContentCheck(!1,s),a&&(a.parentGridNode=s),this._updateContainerHeight()),this.engine.addedNodes.push(s),this._triggerAddEvent(),this._triggerChangeEvent(),this.engine.endUpdate(),this._gsEventHandler.dropped&&this._gsEventHandler.dropped({...t,type:"dropped"},n&&n.grid?n:void 0,s),!1}),this}static _itemRemoving(t,e){if(t){const i=t?t.gridstackNode:void 0;i?.grid&&!t.classList.contains(i.grid.opts.removableOptions.decline)&&(e?i._isAboutToRemove=!0:delete i._isAboutToRemove,e?t.classList.add("grid-stack-item-removing"):t.classList.remove("grid-stack-item-removing"))}}_setupRemoveDrop(){if("string"!=typeof this.opts.removable)return this;var t=document.querySelector(this.opts.removable);return t&&(this.opts.staticGrid||dd.isDroppable(t)||dd.droppable(t,this.opts.removableOptions).on(t,"dropover",(t,e)=>GridStack._itemRemoving(e,!0)).on(t,"dropout",(t,e)=>GridStack._itemRemoving(e,!1))),this}prepareDragDrop(r,t=!1){const o=r?.gridstackNode;if(o){var e=o.noMove||this.opts.disableDrag,i=o.noResize||this.opts.disableResize,n=this.opts.staticGrid||e&&i;if((t||n)&&(o._initDD&&(this._removeDD(r),delete o._initDD),n&&r.classList.add("ui-draggable-disabled","ui-resizable-disabled"),!t))return this;if(!o._initDD){let i,s;var n=(t,e)=>{this.triggerEvent(t,t.target),i=this.cellWidth(),s=this.getCellHeight(!0),this._onStartMoving(r,t,e,o,i,s)},t=(t,e)=>{this._dragOrResize(r,t,e,o,i,s)},a=t=>{this.placeholder.remove(),delete this.placeholder.gridstackNode,delete o._moving,delete o._resizing,delete o._event,delete o._lastTried;var e=o.w!==o._orig.w,i=t.target;if(i.gridstackNode&&i.gridstackNode.grid===this){if(o.el=i,o._isAboutToRemove){const s=r.gridstackNode.grid;s._gsEventHandler[t.type]&&s._gsEventHandler[t.type](t,i),s.engine.nodes.push(o),s.removeWidget(r,!0,!0)}else Utils.removePositioningStyles(i),o._temporaryRemoved?(this._writePosAttr(i,o),this.engine.addNode(o)):this._writePosAttr(i,o),this.triggerEvent(t,i);this._extraDragRow=0,this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate(),"resizestop"===t.type&&(Number.isInteger(o.sizeToContent)&&(o.sizeToContent=o.h),this.resizeToContentCheck(e,o))}};dd.draggable(r,{start:n,stop:a,drag:t}).resizable(r,{start:n,stop:a,resize:t}),o._initDD=!0}return dd.draggable(r,e?"disable":"enable").resizable(r,i?"disable":"enable"),this}}_onStartMoving(t,e,i,s,r,o){var n;this.engine.cleanNodes().beginUpdate(s),this._writePosAttr(this.placeholder,s),this.el.appendChild(this.placeholder),(this.placeholder.gridstackNode=s).grid?.el?this.dragTransform=Utils.getValuesFromTransformedElement(t):this.placeholder&&this.placeholder.closest(".grid-stack")?(n=this.placeholder.closest(".grid-stack"),this.dragTransform=Utils.getValuesFromTransformedElement(n)):this.dragTransform={xScale:1,xOffset:0,yScale:1,yOffset:0},s.el=this.placeholder,s._lastUiPosition=i.position,s._prevYPix=i.position.top,s._moving="dragstart"===e.type,s._resizing="resizestart"===e.type,delete s._lastTried,"dropover"===e.type&&s._temporaryRemoved&&(this.engine.addNode(s),s._moving=!0),this.engine.cacheRects(r,o,this.opts.marginTop,this.opts.marginRight,this.opts.marginBottom,this.opts.marginLeft),"resizestart"===e.type&&(n=this.getColumn()-s.x,i=(this.opts.maxRow||Number.MAX_SAFE_INTEGER)-s.y,dd.resizable(t,"option","minWidth",r*Math.min(s.minW||1,n)).resizable(t,"option","minHeight",o*Math.min(s.minH||1,i)).resizable(t,"option","maxWidth",r*Math.min(s.maxW||Number.MAX_SAFE_INTEGER,n)).resizable(t,"option","maxWidthMoveLeft",r*Math.min(s.maxW||Number.MAX_SAFE_INTEGER,s.x+s.w)).resizable(t,"option","maxHeight",o*Math.min(s.maxH||Number.MAX_SAFE_INTEGER,i)).resizable(t,"option","maxHeightMoveUp",o*Math.min(s.maxH||Number.MAX_SAFE_INTEGER,s.y+s.h)))}_dragOrResize(t,e,i,s,r,o){const n={...s._orig};let a;var d=this.opts.marginLeft,l=this.opts.marginRight,h=this.opts.marginTop,g=this.opts.marginBottom,c=Math.round(.1*o),m=Math.round(.1*r),d=Math.min(d,m),l=Math.min(l,m),h=Math.min(h,c),g=Math.min(g,c);if("drag"===e.type){if(s._temporaryRemoved)return;m=i.position.top-s._prevYPix,c=(s._prevYPix=i.position.top,!1!==this.opts.draggable.scroll&&Utils.updateScrollPosition(t,i.position,m),i.position.left+(i.position.left>s._lastUiPosition.left?-l:d)),m=i.position.top+(i.position.top>s._lastUiPosition.top?-g:h),c=(n.x=Math.round(c/r),n.y=Math.round(m/o),this._extraDragRow);if(this.engine.collide(s,n)){m=this.getRow();let t=Math.max(0,n.y+s.h-m);this.opts.maxRow&&m+t>this.opts.maxRow&&(t=Math.max(0,this.opts.maxRow-m)),this._extraDragRow=t}else this._extraDragRow=0;if(this._extraDragRow!==c&&this._updateContainerHeight(),s.x===n.x&&s.y===n.y)return}else if("resize"===e.type){if(n.x<0)return;if(Utils.updateScrollResize(e,t,o),n.w=Math.round((i.size.width-d)/r),n.h=Math.round((i.size.height-h)/o),s.w===n.w&&s.h===n.h)return;if(s._lastTried&&s._lastTried.w===n.w&&s._lastTried.h===n.h)return;m=i.position.left+d,c=i.position.top+h;n.x=Math.round(m/r),n.y=Math.round(c/o),a=!0}s._event=e,s._lastTried=n;t={x:i.position.left+d,y:i.position.top+h,w:(i.size?i.size.width:s.w*r)-d-l,h:(i.size?i.size.height:s.h*o)-h-g};this.engine.moveNodeCheck(s,{...n,cellWidth:r,cellHeight:o,rect:t,resizing:a})&&(s._lastUiPosition=i.position,this.engine.cacheRects(r,o,h,l,g,d),delete s._skipDown,a&&s.subGrid&&s.subGrid.onResize(),this._extraDragRow=0,this._updateContainerHeight(),m=e.target,s._sidebarOrig||this._writePosAttr(m,s),this.triggerEvent(e,m))}triggerEvent(t,e){let i=this;for(;i.parentGridNode;)i=i.parentGridNode.grid;i._gsEventHandler[t.type]&&i._gsEventHandler[t.type](t,e)}_leave(t,e){const i=(e=e||t).gridstackNode;i&&(e.style.transform=e.style.transformOrigin=null,dd.off(t,"drag"),i._temporaryRemoved||(i._temporaryRemoved=!0,this.engine.removeNode(i),i.el=i._isExternal&&e?e:t,e=i._sidebarOrig,i._isExternal&&this.engine.cleanupNode(i),i._sidebarOrig=e,!0===this.opts.removable&&GridStack._itemRemoving(t,!0),t._gridstackNodeOrig?(t.gridstackNode=t._gridstackNodeOrig,delete t._gridstackNodeOrig):i._isExternal&&this.engine.restoreInitial()))}commit(){return obsolete(this,this.batchUpdate(!1),"commit","batchUpdate","5.2"),this}}GridStack.renderCB=(t,e)=>{t&&e?.content&&(t.textContent=e.content)},GridStack.resizeToContentParent=".grid-stack-item-content",GridStack.Utils=Utils,GridStack.Engine=GridStackEngine,GridStack.GDRev="12.3.2";export{GridStack};